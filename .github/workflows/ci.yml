name: CI
on:
  push:
    branches:
      - 'main'
  pull_request:
env:
  SAUCE_USERNAME: ${{secrets.SAUCE_USERNAME}}
  SAUCE_ACCESS_KEY: ${{secrets.SAUCE_ACCESS_KEY}}
  resourceGroup: ${GITHUB_SHA}
jobs:
  build:
    name: build
    runs-on: macOS-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v1
      - name: Full Build
        run: ./fullbuild.sh
      - name: Smoke Test
        run: | 
         ./smoketest.sh 
      - name: Uploading app on sauce lab
        run: |
           cd /Users/runner/work/splunk-otel-ios/splunk-otel-ios/
           ls
           curl -u "${{secrets.SAUCE_USERNAME}}:${{secrets.SAUCE_ACCESS_KEY}}" --location \
             --request POST 'https://api.us-west-1.saucelabs.com/v1/storage/upload' \
             --form 'payload=@"SmokeTest.zip"' \
             --form 'name="SmokeTest.zip"' \
             --form 'description="'"${{ env.resourceGroup }}"'"' 
          
    
    
  sauce-lab:
    needs: build  
    runs-on: macOS-latest
    strategy:
        fail-fast: false
        matrix:
         os: ['12.4',12.4]
         device: ['iPhone XR Simulator','iPhone 8 Simulator']
         
    steps:
      - name: Checkout
        uses: actions/checkout@v2
          

   
 
